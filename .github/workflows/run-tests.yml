name: Run Auto Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: '18'
    - run: npm ci
    - run: npx playwright install --with-deps chromium
    
    # –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
    - name: üìÅ Show full project structure
      run: |
        echo "=== CURRENT DIRECTORY ==="
        pwd
        echo "=== LIST ALL FILES ==="
        ls -la
        echo "=== TESTS FOLDER ==="
        ls -la tests/ || echo "‚ùå tests/ not found"
        echo "=== TESTS/UI FOLDER ==="
        ls -la tests/UI/ || echo "‚ùå tests/UI/ not found"
        echo "=== TESTS/UI/SPECS FOLDER ==="
        ls -la tests/UI/specs/ || echo "‚ùå tests/UI/specs/ not found"
        echo "=== TESTS/API FOLDER ==="
        ls -la tests/API/ || echo "‚ùå tests/API/ not found"
        echo "=== TESTS/API/SPECS FOLDER ==="
        ls -la tests/API/specs/ || echo "‚ùå tests/API/specs/ not found"
        echo "=== PLAYWRIGHT CONFIG ==="
        cat playwright.config.js | grep -A 10 "projects:"
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ npm run
    - name: üß™ Run UI tests directly
      run: |
        echo "Running UI tests from tests/UI/specs/"
        npx playwright test tests/UI/specs/*.test.js --project=ui-tests || echo "UI tests failed but continuing"
      continue-on-error: true
      
    - name: üß™ Run API tests directly
      run: |
        echo "Running API tests from tests/API/specs/"
        npx playwright test tests/API/specs/*.test.js --project=api-tests || echo "API tests failed but continuing"
      continue-on-error: true
      
    - if: always()
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        message: |
          Diploma Project: Sauce Demo
          Tests completed!
          Status: ${{ job.status }}
          Branch: ${{ github.ref_name }}