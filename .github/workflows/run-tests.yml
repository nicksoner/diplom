name: Run Auto Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: '18'
    - run: npm ci
    - run: npx playwright install --with-deps chromium
    
    # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ UI Ñ‚ĞµÑÑ‚Ñ‹
    - name: ğŸ§ª Run UI tests
      run: npx playwright test tests/UI/specs/ --project=ui-tests
      continue-on-error: true
      
    # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ API Ñ‚ĞµÑÑ‚Ñ‹  
    - name: ğŸ§ª Run API tests
      run: npx playwright test tests/API/specs/ --project=api-tests
      continue-on-error: true
      
    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Telegram
    - if: always()
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        message: |
          ğŸ“ **Diploma Project: Sauce Demo**
          
          âœ… **Tests completed!**
          
          ğŸ“Š Status: ${{ job.status }}
          ğŸŒ¿ Branch: ${{ github.ref_name }}
          ğŸ”— https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

          - name: Upload to Allure TestOps
  if: always()
  run: |
    npm install -g allure-testops
    allure-testops upload allure-results
  env:
    ALLURE_TOKEN: ${{ secrets.ALLURE_TOKEN }}
    ALLURE_ENDPOINT: https://allure.autotests.cloud
    ALLURE_PROJECT_ID: 1